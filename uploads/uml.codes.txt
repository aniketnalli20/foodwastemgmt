@startuml
' Use Case Diagram: No Starve
skinparam usecaseBorderColor #2D3748
skinparam usecaseBackgroundColor #EDF2F7
skinparam packageBorderColor #CBD5E0
top to bottom direction

actor "User" as User
actor "Meal Provider" as Provider
actor "Administrator" as Admin
actor "Map/Location Service" as Map <<external>>
actor "Payment Gateway" as Payment <<external>>

rectangle "NO STARVE PLATFORM" as NSP {
  (Authenticate) as UC_Auth
  (Manage Profile Data) as UC_Profile
  (Browse Nearby Meals) as UC_Browse
  (Search/Filter Meals) as UC_Search
  (View Meal Details) as UC_View
  (Reserve/Claim Meal) as UC_Reserve
  (Connect with Provider) as UC_Contact
  (Check Availability) as UC_Avail
  (Submit Meal Listing) as UC_Submit
  (Update Listing/Inventory) as UC_Update
  (Moderate Listings) as UC_Moderate
  (Generate Activity/Impact Reports) as UC_Reports
  (Notifications) as UC_Notify
  (Map Integration) as UC_Map
}

User -- UC_Auth
User -- UC_Profile
User -- UC_Browse
User -- UC_Search
User -- UC_View
User -- UC_Reserve
User -- UC_Contact

Provider -- UC_Auth
Provider -- UC_Submit
Provider -- UC_Update
Provider -- UC_Avail
Provider -- UC_Contact

Admin -- UC_Moderate
Admin -- UC_Reports

Map -- UC_Map
Payment -- UC_Reserve

UC_Browse ..> UC_Map : <<include>>
UC_Search ..> UC_Map : <<include>>
UC_Reserve ..> UC_Auth : <<include>>
UC_Reserve ..> UC_Avail : <<include>>
UC_Submit ..> UC_Auth : <<include>>
UC_Update ..> UC_Auth : <<include>>
UC_Submit ..> UC_Notify : <<extend>>
UC_Reserve ..> UC_Notify : <<extend>>

legend left
' Diagram Notes
Components:
- Actors: User, Meal Provider, Administrator, external Map and Payment systems.
- System Boundary: "NO STARVE PLATFORM" contains all use cases.
- Associations: lines show who can access which use case.
- Relationships: include = mandatory subflow; extend = optional follow-up.
endlegend
'
' End: Use Case Diagram

@enduml
' --- Next Diagram: Sequence (Reserve/Claim Meal) ---
@startuml
' Sequence Diagram: Reserve/Claim Meal
title Reserve/Claim Meal Sequence

actor User
participant "Browser (http://127.0.0.1:8080)" as Web
participant "index.php" as Index
participant "app.php (helpers)" as App
database "Database (PDO)" as DB
actor "Meal Provider" as Provider
participant "Map Service" as Map

User -> Web: Open Home
Web -> Index: GET /index.php
activate Index
Index -> DB: SELECT open listings
DB --> Index: listings
Index --> Web: Render listings
deactivate Index

User -> Web: Submit claim form
Web -> Index: POST /index.php?action=claim_listing
activate Index
Index -> DB: BEGIN
Index -> DB: INSERT INTO claims
Index -> DB: UPDATE listings SET status='claimed'
DB --> Index: COMMIT
Index --> Web: 200 OK + "Listing claimed successfully"
deactivate Index
Web --> User: Show success

opt View map
User -> Web: Click Map link
Web -> Map: GET (search or lat/lon)
Map --> Web: Map page
end

alt Invalid input
Index --> Web: 400 + validation error
else Database failure
Index --> Web: 500 + failure note
end

' End: Reserve/Claim Meal Sequence
@enduml
@startuml
' --- Next Diagram: Activity (Meal Discovery and Claim) ---
' Activity Diagram: Meal Discovery and Claim
title Meal Discovery and Claim Activity

start

partition User {
  :Open Home Page (#hero);
  :Optionally set filters: city, pincode;
}

partition "Server (index.php)" {
  :Build WHERE (city LIKE, pincode LIKE, status='open');
  :SELECT open listings\nORDER BY COALESCE(expires_at, far-future), id DESC LIMIT 20;
  :Render campaign list and stats;
}

partition Map {
  :External map link (Google Maps search or lat/lon);
}

if (User clicks Map?) then (yes)
  :Open Map;
else (no)
endif

if (User chooses a listing?) then (yes)
  partition "Server (index.php)" {
    if (Listing status == 'open'?) then (yes)
      :Show claim form (name, contact, NGO, notes);
    else (no)
      :Show message: already claimed;
      :Return to listings;
    endif
  }

  partition User {
    :Submit claim;
  }

  partition "Server (index.php)" {
    :Validate listing_id > 0;
    :Validate claimer_name not empty;
    if (Valid?) then (yes)
      partition DB {
        :BEGIN;
        :INSERT INTO claims;
        :UPDATE listings SET status='claimed',\nclaimed_at=now WHERE id = ? AND status='open';
        :COMMIT;
      }
      :Set success message;
    else (no)
      :Set error message;
    endif
  }
else (no)
  :Continue browsing campaigns;
endif

stop

' End: Activity Diagram
@enduml
@startuml
' --- Next Diagram: Class (Core Entities) ---
' Class Diagram: No Starve Core
skinparam classAttributeIconSize 0
hide methods

class User {
  +id: int
  +username: string
  +email: string
  +password_hash: string
  +phone: string?
  +address: text?
  +created_at: datetime
  +is_admin: bool
  +followers_override: int?
}

class Campaign {
  +id: int
  +user_id: int?
  +title: string
  +summary: text?
  +area: string?
  +status: CampaignStatus
  +created_at: datetime
  +contributor_name: string
  +location: string?
  +crowd_size: int?
  +image_url: string?
  +closing_time: datetime?
  +latitude: float?
  +longitude: float?
  +endorse_campaign: int?
  +endorse_contributor: int?
}

class Listing {
  +id: int
  +donor_type: string
  +donor_name: string
  +contact: string?
  +item: string
  +quantity: string
  +address: text
  +city: string
  +pincode: string
  +expires_at: datetime?
  +image_url: string?
  +status: ListingStatus
  +created_at: datetime
  +claimed_at: datetime?
}

class Claim {
  +id: int
  +listing_id: int
  +ngo_name: string?
  +claimer_name: string
  +contact: string?
  +notes: text?
  +created_at: datetime
}

class KarmaWallet {
  +user_id: int
  +balance: int
  +updated_at: datetime
}

class KarmaEvent {
  +id: int
  +user_id: int
  +amount: int
  +reason: string?
  +ref_type: string?
  +ref_id: int?
  +created_at: datetime
}

class KycRequest {
  +id: int
  +user_id: int
  +full_name: string
  +phone: string
  +address: text
  +bank_account_name: string
  +bank_account_number: string
  +ifsc: string
  +bank_name: string
  +id_number: string
  +status: KycStatus
  +notes: text?
  +created_at: datetime
  +updated_at: datetime
}

class Contributor {
  +name: string
  +verified: bool
  +created_at: datetime
  +updated_at: datetime
}

class Follow {
  +id: int
  +follower_user_id: int
  +target_user_id: int?
  +contributor_name: string?
  +created_at: datetime
}

class Endorsement {
  +id: int
  +user_id: int
  +campaign_id: int
  +created_at: datetime
}

interface MapService <<external>> {
  +reverse(lat, lon)
  +search(q)
}

enum CampaignStatus {
  open;
  closed
}
enum ListingStatus {
  open;
  claimed
}
enum KycStatus {
  pending;
  approved;
  rejected
}

User "1" -- "0..*" Campaign : creates
User "1" o-- "1" KarmaWallet : owns
User "1" -- "0..*" KarmaEvent : has
User "1" -- "0..*" KycRequest : submits

Campaign "1" -- "0..*" Endorsement : endorsed-by
Endorsement "0..*" --> User : by

Listing "1" -- "0..*" Claim : has
Claim --> Listing : listing_id

Follow --> User : follower
Follow --> User : target
Follow --> Contributor : alt-target

Contributor "1" <-- "0..*" Campaign : by-name

Campaign ..> MapService : map link
KarmaEvent ..> Campaign : ref_type='campaign'

note right of Campaign
coins_received via KarmaEvent sum
contributor_verified via Contributors
end note

' End: Class Diagram
@enduml
@startuml
' --- Next Diagram: Flowchart (User Journey) ---
' Flowchart: No Starve User Journey
title User Journey Flowchart

start
:Open Home (index.php);
if (Logged in?) then (yes)
  :Show nav: Profile, Wallet, KYC, Create Campaign;
  if (Submit Meal Listing?) then (yes)
    :Fill listing form (donor_type, donor_name, item, quantity, address, city, pincode, expires_at, image);
    :Validate required fields;
    if (Valid?) then (yes)
      :INSERT INTO listings (status='open');
      :Success toast;
    else (no)
      :Show validation errors;
    endif
  else (no)
    :Browse campaigns and open listings;
    :Optionally filter by city/pincode;
    if (Select listing?) then (yes)
      if (Listing is 'open'?) then (yes)
        :Fill claim form (name, contact, NGO, notes);
        :BEGIN; INSERT claim; UPDATE listing status='claimed'; COMMIT;
        :Success toast;
      else (no)
        :Show "already claimed";
      endif
    else (no)
      :Continue browsing;
    endif
  endif
else (no)
  :Public browse (campaigns); Optional Map link;
  :Login/Register (login.php / register.php);
  if (Auth success?) then (yes)
    :Redirect to requested page (next) or #hero;
  else (no)
    :Show error message;
  endif
endif
stop

' End: Flowchart Diagram
@enduml
@startuml
' --- Next Diagram: ER (Database Schema) ---
' ER Diagram: No Starve Database
title Entity Relationship Diagram

hide methods
skinparam classAttributeIconSize 0

entity "users" as users {
  * id : INT
  --
  username : VARCHAR
  email : VARCHAR
  password_hash : VARCHAR
  phone : VARCHAR?
  address : TEXT?
  is_admin : BOOL
  followers_override : INT?
  created_at : DATETIME
}

entity "campaigns" as campaigns {
  * id : INT
  --
  user_id : INT?
  title : VARCHAR
  summary : TEXT?
  area : VARCHAR?
  status : ENUM(open, closed)
  created_at : DATETIME
  contributor_name : VARCHAR
  location : VARCHAR?
  crowd_size : INT?
  image_url : VARCHAR?
  closing_time : DATETIME?
  latitude : FLOAT?
  longitude : FLOAT?
  endorse_campaign : INT?
  endorse_contributor : INT?
}

entity "listings" as listings {
  * id : INT
  --
  donor_type : VARCHAR
  donor_name : VARCHAR
  contact : VARCHAR?
  item : VARCHAR
  quantity : VARCHAR
  address : TEXT
  city : VARCHAR
  pincode : VARCHAR
  expires_at : DATETIME?
  image_url : VARCHAR?
  status : ENUM(open, claimed)
  created_at : DATETIME
  claimed_at : DATETIME?
}

entity "claims" as claims {
  * id : INT
  --
  listing_id : INT
  ngo_name : VARCHAR?
  claimer_name : VARCHAR
  contact : VARCHAR?
  notes : TEXT?
  created_at : DATETIME
}

entity "karma_wallets" as wallets {
  * user_id : INT
  --
  balance : INT
  updated_at : DATETIME
}

entity "karma_events" as events {
  * id : INT
  --
  user_id : INT
  amount : INT
  reason : VARCHAR?
  ref_type : VARCHAR?
  ref_id : INT?
  created_at : DATETIME
}

entity "kyc_requests" as kyc {
  * id : INT
  --
  user_id : INT
  full_name : VARCHAR
  phone : VARCHAR
  address : TEXT
  bank_account_name : VARCHAR
  bank_account_number : VARCHAR
  ifsc : VARCHAR
  bank_name : VARCHAR
  id_number : VARCHAR
  status : ENUM(pending, approved, rejected)
  notes : TEXT?
  created_at : DATETIME
  updated_at : DATETIME
}

entity "contributors" as contributors {
  * name : VARCHAR
  --
  verified : BOOL
  created_at : DATETIME
  updated_at : DATETIME
}

entity "follows" as follows {
  * id : INT
  --
  follower_user_id : INT
  target_user_id : INT?
  contributor_name : VARCHAR?
  created_at : DATETIME
}

entity "endorsements" as endorsements {
  * id : INT
  --
  user_id : INT
  campaign_id : INT
  created_at : DATETIME
}

' Relationships
users ||--o{ campaigns : creates
users ||--|| wallets : owns
users ||--o{ events : has
users ||--o{ kyc : submits

campaigns ||--o{ endorsements : endorsed-by
endorsements }o--|| users : by

listings ||--o{ claims : has
claims }o--|| listings : for

follows }o--|| users : follower
follows }o--o| users : target
follows }o--|| contributors : alt-target

contributors ||--o{ campaigns : by-name

events }o--|| campaigns : ref (when ref_type='campaign')

' End: ER Diagram
@enduml
@startuml
' --- Next Diagram: Component (Architecture) ---
' Component Diagram: No Starve Architecture
scale 0.7
title Component Diagram (Medium)

component "Web Client" as Client
component "PHP Frontend\n(index.php)" as Front
component "Auth Module\n(login.php, register.php)" as Auth
component "Listing Service\n(create/claim)" as Listing
component "Campaign Service\n(create_campaign.php, app.php)" as Campaign
component "Wallet Service\n(wallet.php, app.php)" as WalletSvc
component "KYC Service\n(kyc.php)" as KYCSvc
component "Social Service\n(follow.php, endorse.php)" as SocialSvc
component "Stats API\n(stats.php)" as StatsAPI
component "Geocode API\n(geocode.php)" as GeocodeAPI
component "Admin Tools\n(admin/index.php)" as Admin
database "Database (PDO)" as DB
cloud "External Map" as ExtMap
cloud "Email SMTP" as SMTP

Client --> Front
Front --> Auth
Front --> Listing
Front --> Campaign
Front --> WalletSvc
Front --> SocialSvc
Front --> StatsAPI
Front --> GeocodeAPI
Front ..> ExtMap : map link

Admin --> Auth
Admin --> Campaign
Admin --> WalletSvc
Admin --> KYCSvc
Admin --> StatsAPI

Auth --> DB
Listing --> DB
Campaign --> DB
WalletSvc --> DB
KYCSvc --> DB
StatsAPI --> DB
GeocodeAPI ..> ExtMap
Auth ..> SMTP : password reset

note right of Front
Runs on port 8080 (homepage)
end note

' End: Component Diagram
@enduml